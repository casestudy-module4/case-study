<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="https://cdn.lineicons.com/4.0/lineicons.css" rel="stylesheet"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" th:href="@{/style.css}">
</head>
<body>
<div class="wrapper">
    <div th:replace="sidebar.html :: sidebar"></div>
    <div class="main p-4">
        <div class="d-flex justify-content-end mb-3">
            <form class="d-flex" style="width: 20%;" role="search">
                <input class="form-control me-2" type="search" placeholder="Search by title" aria-label="Search"
                       name="title" id="title2" th:value="${fullName}">
                <button class="btn btn-outline-success bi bi-search" type="button" id="btn-search"
                        onclick="searchByTitle()"></button>
            </form>
        </div>
        <div class="text-center mb-4">
            <h1>Customer List</h1>
        </div>
        <table class="table table-hover align-middle">
            <thead class="table-light">
            <tr>
                <th scope="col">#</th>
                <th scope="col">FullName</th>
                <th scope="col">Gmail</th>
                <th scope="col">Gender</th>
                <th scope="col">Age</th>
                <th scope="col">Action</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="row:${customer}">
                <td th:text="${row.id}"></td>
                <td th:text="${row.fullName}"></td>
                <td th:text="${row.email}"></td>
                <td th:text="${row.gender==0} ? 'Nam' : 'Nữ'"></td>
                <td th:text="${row.age}"></td>
                <td>
                    <button type="button" class="btn btn-info bi bi-eye-fill"
                            th:onclick="'openModal(' + ${row.id} + ')'"></button>
                    <button type="button" class="btn btn-danger bi bi-trash"
                            th:onclick="'confirmDelete(' + ${row.id} + ')'"></button>
                </td>
            </tr>
            <tr th:if="${customer.content.isEmpty()}">
                <td colspan="6" class="text-center">No Customers found</td>
            </tr>
            </tbody>
        </table>
        <nav aria-label="Page navigation">
            <ul class="pagination">
                <!-- Previous -->
                <li class="page-item" th:if="${customer.hasPrevious()}">
                    <a class="page-link"
                       th:href="@{/admins/customers(page=${T(Math).max(0, customer.number - 1)}, title=${fullName})}"
                       aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
<!--                &lt;!&ndash; Page Numbers &ndash;&gt;-->
<!--                <li class="page-item" th:each="i : ${#numbers.sequence(0, customer.totalPages - 1)}"-->
<!--                    th:classappend="${i == customer.number} ? 'active' : ''">-->
<!--                    <a class="page-link" th:href="@{/admins/customers(page=${i}, title=${fullName})}"-->
<!--                       th:text="${i + 1}"></a>-->
<!--                </li>-->
                <!-- Next -->
                <li class="page-item" th:if="${customer.hasNext()}">
                    <a class="page-link" th:href="@{/admins/customers(page=${customer.number + 1}, title=${fullName})}"
                       aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            </ul>
        </nav>
        <div class="modal fade" id="customerModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content" id="modalContent">
                    <!-- Nội dung modal sẽ được tải động -->
                </div>
            </div>
        </div>
        <div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmLabel"
             aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="deleteConfirmLabel">Confirm Delete</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        Are you sure you want to delete this customer?
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <form id="deleteCustomerForm" th:action="@{/admins/customers/delete/id}" method="post">
                            <button type="submit" class="btn btn-danger">Delete</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div th:replace="toast.html :: toast"></div>
    </div>
</div>
</body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
        crossorigin="anonymous"></script>
<script th:src="@{/script.js}"></script>
<script>
    function searchByTitle() {
        let title = document.getElementById("title2").value;
        let updateLink = "/admins/customers?fullName=" + title + "&page=0";
        window.location.href = updateLink;
    }

    function openModal(customerId) {
        fetch(`/admins/customers/${customerId}`)
            .then(response => {
                if (!response.ok) throw new Error("Failed to load customer details");
                return response.text();
            })
            .then(html => {
                document.getElementById('modalContent').innerHTML = html;
                new bootstrap.Modal(document.getElementById('customerModal')).show();
            })
            .catch(error => console.error('Error loading customer details:', error));
    }

    function confirmDelete(customerId) {
        const form = document.getElementById('deleteCustomerForm');
        form.action = `/admins/customers/${customerId}/delete`;
        new bootstrap.Modal(document.getElementById('deleteConfirmModal')).show();
    }

    document.addEventListener("DOMContentLoaded", function () {
        const toastElement = document.querySelector('.toast');
        if (toastElement) {
            const toast = new bootstrap.Toast(toastElement);
            toast.show();
        }
    });
</script>
</html>
